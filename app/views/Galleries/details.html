#{extends 'main.html'/}
#{set title: "Crowd - " + gallery.name/}

#{set 'moreStyles'}
	<link rel="stylesheet" media="screen" href="@{'/public/stylesheets/galleries/details.css'}"/>
#{/set}


#{set 'moreScripts'}
	<script type="text/javascript">
	var showPhotoDetailsAction = #{jsAction @Photos.details(':id') /}
    
	function showTwitterLink() {
	    $(this).find('a.open-tweet').stop().css('opacity', 1);
	}

	function hideTwitterLink() {
	    $(this).find('a.open-tweet').animate({opacity:0}, 'fast');
	}

	$(document).ready(function() {
	    $('#recent-activity li a.open-tweet').css('opacity', 0);
	    $('#recent-activity li').mouseenter(showTwitterLink).mouseleave(hideTwitterLink);

	    var lastFetchedMessage = 0;
			var galleryId = $("#gallery").attr("data-galleryid");

	    $('#moreButton').click(function() {
					var lastPhotoId = $(".photo-item").length > 0 ? $(".photo-item").last().attr("data-id") : 0;
	        $.ajax({
	                url: '${gallery.id}/photos/older?startId=' + lastPhotoId,
	                contentType: 'application/json; charset=utf-8',
	                dataType: 'json',
	                success: morePhoto
	        });
	        return false;
	    });
    
	    $('#new-photo-bar').click(function() {
					var firstPhotoId = $(".photo-item").length > 0 ? $(".photo-item").first().attr("data-id") : 0;			
	        $.ajax({
	                url: '${gallery.id}/photos/newer?lastId=' + firstPhotoId,
	                contentType: 'application/json; charset=utf-8',
	                dataType: 'json',
	                success: newPhoto
	        });
	        return false;
	    });
    
	});


	function morePhoto(json) {
	    $.each(json.photos,function(i,photo){
	        $("#photos").append('<div class="photo-item" data-id="' + photo.id + '"> <div class="photo"> <a href="' + showPhotoDetailsAction({id:photo.id}) + '"> <img alt="photo"src="'+photo.image_thumb+'"></a></div><a href="http://twitter.com/#!/' + photo.poster + '" class="poster">'+photo.poster+'</a><p>'+photo.tweet_text+'</p></div>')
	    });
	    $('#photos').find(".new-item").slideDown("slow");
	}

	function newPhoto(json) {
	    $.each(json.photos,function(i,photo){
	       $("#photos").prepend('<div class="photo-item" data-id="' + photo.id + '"> <div class="photo"> <a href="' + showPhotoDetailsAction({id:photo.id}) + '"> <img alt="photo"src="'+photo.image_thumb+'"></a></div><a href="http://twitter.com/#!/' + photo.poster + '" class="poster">'+photo.poster+'</a><p>'+photo.tweet_text+'</p></div>')
	    });
	    $('#photos').find(".new-item").slideDown("slow");
	}
	</script>
#{/set}
			<article id="gallery" data-galleryid="${gallery.id}">
             <h1>${gallery.name}</h1>
             <div id="album-date">${gallery.dateCreated.format("EEEE, dd MMMM yyyy")}</div>
             <div id="album-hashtag">#${gallery.hashtag}</div>
             <h3>A crowd by <a href="@{Users.galleries(gallery.user.username)}">${gallery.user.username}</a></h3>
             <div id="album-info-column-container">
                 <div id="album-info-column-left">
                     <!-- 255 characters -->
                     #{if gallery.description}
                     <div id="album-description">
                         <p>${gallery.description}</p>
                     </div>
                     #{/if}
                     <!--
                     <div id="new-photo-bar" style="">2 new tweets</div>
                     -->
                     <div id="photos">
						#{list photos, as:'photo'}
                         <div class="photo-item" data-id="${photo.id}">
                             <div class="photo">
                                 <a href="@{Photos.details(photo.id)}">
                                     <img alt="photo" src="${photo.thumbImageUrl}">
                                 </a>
                             </div>
                             <a href="http://twitter.com/#!/${photo.poster.username}" class="poster">@${photo.poster.username}</a>
                             <p>${photo.message}</p>
                         </div>
						#{/list}                     
                     </div>
                     <div class="more">
                         <a href="#"  id="moreButton" class="button blue" data-page="2">More</a>
                     </div>

                 </div>
             </div>
			</article>

